/**
 * Yii form widget.
 *
 * This is the JavaScript widget used by the yii\widgets\ActiveForm widget.
 *
 * @link http://www.yiiframework.com/
 * @copyright Copyright (c) 2008 Yii Software LLC
 * @license http://www.yiiframework.com/license/
 * @author Qiang Xue <qiang.xue@gmail.com>
 * @since 2.0
 */
!function(t){t.fn.yiiActiveForm=function(i){return f[i]?f[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(t.error("Method "+i+" does not exist on jQuery.yiiActiveForm"),!1):f.init.apply(this,arguments)};var i,e="beforeValidate",a="afterValidate",r="beforeValidateAttribute",n="afterValidateAttribute",s="beforeSubmit",o="ajaxBeforeSend",u="ajaxComplete",l="afterInit",d={encodeErrorSummary:!0,errorSummary:".error-summary",validateOnSubmit:!0,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:void 0,scrollToError:!0,scrollToErrorOffset:0,validationStateOn:"container"},c={id:void 0,name:void 0,container:void 0,input:void 0,error:".help-block",encodeError:!0,validateOnChange:!0,validateOnBlur:!0,validateOnType:!1,validationDelay:500,enableAjaxValidation:!1,validate:void 0,status:0,cancelled:!1,value:void 0,updateAriaInvalid:!0},v=function(t){i&&(i.resolve(),i=void 0,t.removeData("yiiSubmitFinalizePromise"))},f={init:function(i,e){return this.each((function(){var a=t(this);if(!a.data("yiiActiveForm")){var r=t.extend({},d,e||{});void 0===r.validationUrl&&(r.validationUrl=a.attr("action")),t.each(i,(function(e){i[e]=t.extend({value:S(a,this)},c,this),h(a,i[e])})),a.data("yiiActiveForm",{settings:r,attributes:i,submitting:!1,validated:!1,options:F(a)}),a.on("reset.yiiActiveForm",f.resetForm),r.validateOnSubmit&&(a.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",(function(){a.data("yiiActiveForm").submitObject=t(this)})),a.on("submit.yiiActiveForm",f.submitForm));var n=t.Event(l);a.trigger(n)}}))},add:function(i){var e=t(this);i=t.extend({value:S(e,i)},c,i),e.data("yiiActiveForm").attributes.push(i),h(e,i)},remove:function(i){var e=t(this),a=e.data("yiiActiveForm").attributes,r=-1,n=void 0;return t.each(a,(function(t){if(a[t].id==i)return r=t,n=a[t],!1})),r>=0&&(a.splice(r,1),m(e,n)),n},validateAttribute:function(i){var e=f.find.call(this,i);null!=e&&g(t(this),e,!0)},find:function(i){var e=t(this).data("yiiActiveForm").attributes,a=void 0;return t.each(e,(function(t){if(e[t].id==i)return a=e[t],!1})),a},destroy:function(){return this.each((function(){t(this).off(".yiiActiveForm"),t(this).removeData("yiiActiveForm")}))},data:function(){return this.data("yiiActiveForm")},validate:function(i){i&&(t(this).data("yiiActiveForm").submitting=!0);var a=t(this),n=a.data("yiiActiveForm"),s=!1,l={},d=A(),c=n.submitting;if(c){var f=t.Event(e);if(a.trigger(f,[l,d]),!1===f.result)return n.submitting=!1,void v(a)}t.each(n.attributes,(function(){this.$form=a;var i=E(a,this);if(i.is(":disabled"))return!0;if(i.length&&"select"===i[0].tagName.toLowerCase()){var e=i[0].options,o=!e||!e.length,u=i.attr("required"),c=i.attr("multiple"),v=i.attr("size")||1;if(u&&!c&&1===parseInt(v,10)){if(o)return!0;if(e[0]&&""!==e[0].value&&""!==e[0].text)return!0}}if(this.cancelled=!1,n.submitting||2===this.status||3===this.status){var f=l[this.id];void 0===f&&(f=[],l[this.id]=f);var h=t.Event(r);a.trigger(h,[this,f,d]),!1!==h.result?(this.validate&&this.validate(this,S(a,this),f,d,a),this.enableAjaxValidation&&(s=!0)):this.cancelled=!0}})),t.when.apply(this,d).always((function(){for(var i in l)0===l[i].length&&delete l[i];if(s&&(t.isEmptyObject(l)||n.submitting)){var e=n.submitObject,r="&"+n.settings.ajaxParam+"="+a.attr("id");e&&e.length&&e.attr("name")&&(r+="&"+e.attr("name")+"="+e.attr("value")),t.ajax({url:n.settings.validationUrl,type:a.attr("method"),data:a.serialize()+r,dataType:n.settings.ajaxDataType,complete:function(t,i){a.trigger(u,[t,i])},beforeSend:function(t,i){a.trigger(o,[t,i])},success:function(i){null!==i&&"object"==typeof i?(t.each(n.attributes,(function(){this.enableAjaxValidation&&!this.cancelled||delete i[this.id]})),j(a,t.extend(l,i),c)):j(a,l,c)},error:function(){n.submitting=!1,v(a)}})}else n.submitting?window.setTimeout((function(){j(a,l,c)}),200):j(a,l,c)}))},submitForm:function(){var e=t(this),a=e.data("yiiActiveForm");if(a.validated){a.submitting=!1;var r=t.Event(s);return e.trigger(r),!1===r.result?(a.validated=!1,v(e),!1):(O(e),!0)}return function(e){i=t.Deferred(),e.data("yiiSubmitFinalizePromise",i.promise())}(e),void 0!==a.settings.timer&&clearTimeout(a.settings.timer),a.submitting=!0,f.validate.call(e),!1},resetForm:function(){var i=t(this),e=i.data("yiiActiveForm");window.setTimeout((function(){t.each(e.attributes,(function(){this.value=S(i,this),this.status=0;var t=i.find(this.container),a=E(i,this);("input"===e.settings.validationStateOn?a:t).removeClass(e.settings.validatingCssClass+" "+e.settings.errorCssClass+" "+e.settings.successCssClass),t.find(this.error).html("")})),i.find(e.settings.errorSummary).hide().find("ul").html("")}),1)},updateMessages:function(i,e){var a=t(this),r=a.data("yiiActiveForm");t.each(r.attributes,(function(){w(a,this,i)})),e&&T(a,i)},updateAttribute:function(i,e){var a=f.find.call(this,i);if(null!=a){var r={};r[i]=e,w(t(this),a,r)}}},h=function(i,e){var a=E(i,e);e.validateOnChange&&a.on("change.yiiActiveForm",(function(){g(i,e,!1)})),e.validateOnBlur&&a.on("blur.yiiActiveForm",(function(){0!=e.status&&1!=e.status||g(i,e,!0)})),e.validateOnType&&a.on("keyup.yiiActiveForm",(function(a){-1===t.inArray(a.which,[16,17,18,37,38,39,40])&&e.value!==S(i,e)&&g(i,e,!1,e.validationDelay)}))},m=function(t,i){E(t,i).off(".yiiActiveForm")},g=function(i,e,a,r){var n=i.data("yiiActiveForm");a&&(e.status=2),t.each(n.attributes,(function(){y(this.value,S(i,this))||(this.status=2,a=!0)})),a&&(void 0!==n.settings.timer&&clearTimeout(n.settings.timer),n.settings.timer=window.setTimeout((function(){n.submitting||i.is(":hidden")||(t.each(n.attributes,(function(){if(2===this.status){this.status=3;var t=i.find(this.container),e=E(i,this);("input"===n.settings.validationStateOn?e:t).addClass(n.settings.validatingCssClass)}})),f.validate.call(i))}),r||200))},y=function(t,i){return t instanceof Object?b(t,i):Array.isArray(t)?p(t,i):t===i},b=function(t,i){if(!(t instanceof Object&&i instanceof Object))return!1;var e=Object.keys(t),a=Object.keys(i);if(e.length!==a.length)return!1;for(var r=0;r<e.length;r+=1){if(!i.hasOwnProperty(e[r]))return!1;if(t[e[r]]!==i[e[r]])return!1}return!0},p=function(t,i){if(!Array.isArray(t)||!Array.isArray(i))return!1;if(t.length!==i.length)return!1;for(var e=0;e<t.length;e+=1)if(t[e]!==i[e])return!1;return!0},A=function(){var i=[];return i.add=function(i){this.push(new t.Deferred(i))},i},C=["action","target","method","enctype"],F=function(t){for(var i={},e=0;e<C.length;e++)i[C[e]]=t.attr(C[e]);return i},j=function(i,e,r){var n=i.data("yiiActiveForm");if(void 0===n)return!1;var s=[];if(t.each(n.attributes,(function(){var t=r&&w(i,this,e)||!r&&x(i,this,e);E(i,this).is(":disabled")||this.cancelled||!t||s.push(this)})),i.trigger(a,[e,s]),r)if(T(i,e),s.length){if(n.settings.scrollToError){var o=t(document).height(),u=i.find(t.map(s,(function(t){return t.input})).join(",")).first().closest(":visible").offset().top-n.settings.scrollToErrorOffset;u=u<0?0:u>o?o:u;var l=t(window).scrollTop();(u<l||u>l+t(window).height())&&t(window).scrollTop(u)}n.submitting=!1}else n.validated=!0,n.submitObject&&function(t,i){for(var e=0;e<C.length;e++){var a=i.attr("form"+C[e]);a&&t.attr(C[e],a)}}(i,n.submitObject),i.submit(),n.submitObject&&function(t){for(var i=t.data("yiiActiveForm"),e=0;e<C.length;e++)t.attr(C[e],i.options[C[e]]||null)}(i);else t.each(n.attributes,(function(){this.cancelled||2!==this.status&&3!==this.status||w(i,this,e)}));v(i)},O=function(i){var e=i.data("yiiActiveForm").submitObject||i.find(":submit:first");if(e.length&&"submit"==e.attr("type")&&e.attr("name")){var a=t('input[type="hidden"][name="'+e.attr("name")+'"]',i);a.length?a.attr("value",e.attr("value")):t("<input>").attr({type:"hidden",name:e.attr("name"),value:e.attr("value")}).appendTo(i)}},w=function(i,e,a){var r=i.data("yiiActiveForm"),s=E(i,e),o=x(i,e,a);if(t.isArray(a[e.id])||(a[e.id]=[]),e.status=1,s.length){var u=i.find(e.container),l=u.find(e.error);D(i,e,o);var d="input"===r.settings.validationStateOn?s:u;o?(e.encodeError?l.text(a[e.id][0]):l.html(a[e.id][0]),d.removeClass(r.settings.validatingCssClass+" "+r.settings.successCssClass).addClass(r.settings.errorCssClass)):(l.empty(),d.removeClass(r.settings.validatingCssClass+" "+r.settings.errorCssClass+" ").addClass(r.settings.successCssClass)),e.value=S(i,e)}return i.trigger(n,[e,a[e.id]]),o},x=function(i,e,a){var r=E(i,e),n=!1;return t.isArray(a[e.id])||(a[e.id]=[]),r.length&&(n=a[e.id].length>0),n},T=function(i,e){var a=i.data("yiiActiveForm"),r=i.find(a.settings.errorSummary),n=r.find("ul").empty();r.length&&e&&(t.each(a.attributes,(function(){if(t.isArray(e[this.id])&&e[this.id].length){var i=t("<li/>");a.settings.encodeErrorSummary?i.text(e[this.id][0]):i.html(e[this.id][0]),n.append(i)}})),r.toggle(n.find("li").length>0))},S=function(i,e){var a=E(i,e),r=a.attr("type");if("checkbox"===r||"radio"===r){var n=a.filter(":checked");if(n.length>1){var s=[];return n.each((function(i){s.push(t(n.get(i)).val())})),s}return n.length||(n=i.find('input[type=hidden][name="'+a.attr("name")+'"]')),n.val()}return a.val()},E=function(t,i){var e=t.find(i.input);return e.length&&"div"===e[0].tagName.toLowerCase()?e.find("input"):e},D=function(t,i,e){i.updateAriaInvalid&&t.find(i.input).attr("aria-invalid",e?"true":"false")}}(window.jQuery);